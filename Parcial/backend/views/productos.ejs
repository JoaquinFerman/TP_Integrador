<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Gestión de Productos</title>
  <link rel="stylesheet" href="http://localhost:3000/frontend/styles/styles-ejs-productos.css">

</head>

<body>
  <nav class="navbar">
    <div class="marca">
      <img src="/frontend/images/logo.png" alt="Logo" class="logo">
      <span class="nombre">ElectroGaming</span>
    </div>
    <p>Panel de administrador</p>
    <div class="nombres">
      <p>Joaquin Ferman</p>
      <p>Matias Pena</p>
    </div>
    <a href="/api/admin/usuarios">Usuarios</a>
    <button id="darkModeToggle" class="icon-btn" title="Cambiar tema">
      <span id="darkModeIcon">🌙</span>
    </button>
  </nav>

  <main class="container mt-4">
    <h2>Agregar nuevo producto</h2>
    <form action="/api/admin/productos" method="POST">
      <input type="text" name="nombre" placeholder="Nombre del producto" required>
      <input type="number" name="precio" step="0.01" placeholder="Precio" required>
      <input type="text" name="descripcion" placeholder="Descripción" required>
      <button type="submit">Agregar</button>
    </form>

    <hr>

    <h2>Lista de productos</h2>
    <div class="product-list">
      <% productos.forEach(producto => { %>
        <div class="product-card<%= producto.activo ? '' : ' shadowed' %>"></div>
          <img src="/frontend/images/<%= producto.nombre %>.jpg" alt="Imagen del producto">
          <info>
            <h3><%= producto.nombre %></h3>
            <p>Precio: $<%= Number(producto.precio).toFixed(2) %></p>
            <p><%= producto.descripcion %></p>
          </info>
            <form action="/api/admin/productos/<%= producto.id %>?_method=PUT" method="POST" style="display:inline;">
            <input type="hidden" name="activo" value="<%= !producto.activo %>">
            <button type="submit"><%= producto.activo ? 'Desactivar' : 'Activar' %></button>
            </form>
            <button type="submit">Eliminar</button>
          </form>
        </div>

          <form action="/api/admin/productos/<%= producto.id %>?_method=PUT" method="POST">
            <input type="text" name="nombre" value="<%= producto.nombre %>" required>
            <input type="number" step="0.01" name="precio" value="<%= producto.precio %>" required>
            <input type="text" name="descripcion" value="<%= producto.descripcion %>" required>
            <button type="submit">Actualizar</button>
          </form>
        
      <% }) %>
    </div>
  </main>
  <script>
  const toggleBtn = document.getElementById('darkModeToggle');
  const icon = document.getElementById('darkModeIcon');
  const darkClass = 'dark-mode';

  // Mantener preferencia en localStorage
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add(darkClass);
    icon.textContent = '☀️';
  }

  toggleBtn.addEventListener('click', () => {
    document.body.classList.toggle(darkClass);
    const isDark = document.body.classList.contains(darkClass);
    icon.textContent = isDark ? '☀️' : '🌙';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  });

  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function () {
      setTimeout(() => {
        location.reload();
      }, 50);
    });
  });
  </script>
</body>
</html>